# Push Notification Admin Panel

A modern push notification management system. Send notifications to web browsers and PWAs using Next.js 15 and React 19.

## ðŸš€ Features

- âœ… **Admin Panel**: Easy-to-use notification sending interface
- âœ… **PWA Support**: Installable as a web application
- âœ… **Service Worker**: Offline functionality and push notification support
- âœ… **PostgreSQL**: Reliable database support
- âœ… **Next.js 15**: Modern React 19 and Server Actions approach
- âœ… **TypeScript**: Development with type safety
- âœ… **Tailwind CSS**: Modern and responsive design
- âœ… **Next-Push**: Easy push notification integration
- âœ… **Real-time Updates**: Live subscription management

## ðŸ“¦ Installation

### 1. Install Dependencies

```bash
# Using npm
npm install

# or using bun (recommended)
bun install
```

### 2. Environment Variables

Create a `.env.local` file:

```env
# Database (PostgreSQL or Neon)
POSTGRES_URL=postgresql://username:password@localhost:5432/database_name

# VAPID Keys (automatically generated by next-push)
NEXT_PUBLIC_VAPID_PUBLIC_KEY=your_public_key_here
VAPID_PRIVATE_KEY=your_private_key_here
```

### 3. Database Setup

Create your PostgreSQL database and load the schema:

```bash
# Local PostgreSQL
psql -d your_database_name -f database/schema.sql

# Or if using Neon
# Run the schema.sql content from the web interface
```

### 4. VAPID Keys

Next-push automatically manages VAPID keys. If you want to create them manually:

```bash
npx web-push generate-vapid-keys
```

### 5. Start Development Server

```bash
# Using npm
npm run dev

# or using bun
bun dev
```

The application will run at `http://localhost:9214`.

## ðŸŽ¯ Usage

### Admin Panel Access

1. Go to `http://localhost:9214` in your browser
2. Click the "Subscribe to Notifications" button
3. The browser will request notification permission, select "Allow"
4. Subscription is now created and you can send notifications!

### Sending Notifications

From the admin panel:
1. **Title**: Enter the notification title
2. **Message**: Enter the notification content
3. **URL** (optional): Page to open when notification is clicked
4. Click the "Send Notification" button

### Subscription Management

- **Subscriber List**: Displays all active subscribers
- **Unsubscribe**: To stop receiving notifications
- **Real-time Updates**: Subscription status updates in real-time

## PWA Features

### Installation

1. Click the "Install" button next to the address bar in Chrome/Edge
2. Or use the "Add to Home Screen" option

### Offline Functionality

- Works offline thanks to Service Worker
- Fast loading with cache strategy
- Background sync support

## ðŸ› ï¸ Technical Details

### Technology Stack

- **Frontend**: Next.js 15 + React 19 + TypeScript
- **Styling**: Tailwind CSS 4
- **Backend**: Server Actions (Next.js App Router)
- **Database**: PostgreSQL + postgres.js driver
- **Push Notifications**: next-push + web-push
- **PWA**: Service Worker + Web App Manifest
- **Development**: Turbopack (dev mode)

### File Structure

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ actions.ts              # Server Actions (push notifications)
â”‚   â”œâ”€â”€ layout.tsx              # Root Layout + PWA setup
â”‚   â”œâ”€â”€ page.tsx                # Admin Panel UI
â”‚   â”œâ”€â”€ globals.css             # Tailwind + global styles
â”‚   â”œâ”€â”€ manifest.ts             # PWA Manifest
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ send-notification/
â”‚           â””â”€â”€ route.ts        # API endpoint
public/
â”œâ”€â”€ sw.js                       # Service Worker
â”œâ”€â”€ *.png                       # PWA icons
â””â”€â”€ *.svg                       # Static assets
database/
â””â”€â”€ schema.sql                  # PostgreSQL schema
```

### Database Schema

```sql
-- Subscriptions table
CREATE TABLE subscriptions (
    id SERIAL PRIMARY KEY,
    endpoint TEXT NOT NULL UNIQUE,
    p256dh TEXT NOT NULL,
    auth TEXT NOT NULL,
    expiration_time TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### Push Notification Flow

1. **Client**: Create subscription using next-push hook
2. **Server Action**: Save subscription to database
3. **Admin Panel**: Send notification to all subscribers
4. **Service Worker**: Catch push event and display

## ðŸš€ Production Deployment

### Vercel (Recommended)

1. Push project to GitHub
2. Create new project on [Vercel](https://vercel.com)
3. Configure environment variables
4. Automatic deployment

### Environment Variables (Production)

```env
# Neon Database (recommended)
POSTGRES_URL=postgresql://user:pass@host/db?sslmode=require

# VAPID Keys
NEXT_PUBLIC_VAPID_PUBLIC_KEY=your_public_key
VAPID_PRIVATE_KEY=your_private_key
```

### Other Platforms

- **Netlify**: Static export support
- **Railway**: PostgreSQL + Node.js hosting
- **PlanetScale**: MySQL alternative
- **Supabase**: PostgreSQL + Auth

### SSL/HTTPS Requirements

Push notifications require HTTPS:
- Vercel: Automatic SSL
- Custom domain: Use Let's Encrypt
- Development: Works on localhost

## ðŸ› Troubleshooting

### Push Notifications Not Working

**Checklist:**
- [ ] Are you using HTTPS? (works on localhost in development)
- [ ] Does the browser allow notifications?
- [ ] Are VAPID keys correct?
- [ ] Is Service Worker loaded? (DevTools > Application > Service Workers)
- [ ] Is subscription saved to database?

**Check Console Errors:**
```bash
# Browser DevTools
F12 > Console > Application

# To see Service Worker errors
chrome://serviceworker-internals/
```

### Database Connection Error

```bash
# Test connection
node -e "const postgres = require('postgres'); const sql = postgres(process.env.POSTGRES_URL); sql\`SELECT 1\`.then(console.log)"

# Check environment variables
echo $POSTGRES_URL
```

### Development Issues

```bash
# Clear cache
rm -rf .next
bun dev

# Reinstall dependencies
rm -rf node_modules bun.lockb
bun install

# Port conflict
lsof -ti:9214 | xargs kill -9
```

### PWA Installation Issues

- Is manifest file present? `/manifest.json`
- Are you using HTTPS?
- Is Service Worker active?
- Are icon files present?

## ðŸ”§ Development

### Scripts

```bash
# Development server (with Turbopack)
bun dev               # Starts on port 9214

# Production build
bun run build
bun start

# Linting
bun run lint

# Type checking
npx tsc --noEmit
```

### Code Structure

**Server Actions (`actions.ts`):**
- `subscribe()`: Save new subscription
- `subscribers()`: Get all subscribers
- `unsubscribe()`: Cancel subscription

**Client Components (`page.tsx`):**
- `useNextPush` hook usage
- Real-time subscriber management
- Push notification UI

### Environment Variables

```env
# Required
POSTGRES_URL=postgresql://...

# Auto-generated by next-push
NEXT_PUBLIC_VAPID_PUBLIC_KEY=
VAPID_PRIVATE_KEY=

# Optional
NEXT_PUBLIC_APP_NAME="Push Notifications"
```

### Database Migrations

For schema changes:

```sql
-- Add new field
ALTER TABLE subscriptions ADD COLUMN user_agent TEXT;

-- Create index
CREATE INDEX idx_subscriptions_user_agent ON subscriptions(user_agent);
```
